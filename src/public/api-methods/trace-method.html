<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>trace | Alkanes Explorer</title>
  <link rel="stylesheet" href="../css/minimal.css">
  <link rel="stylesheet" href="../css/api-methods.css">
  <link rel="stylesheet" href="../css/endpoint-toggle.css">
</head>
<body>
  <!-- Sidebar Navigation -->
  <div class="sidebar">
    <h2>API Methods</h2>
    
    <!-- Core Alkanes Functions -->
    <h3>Core Alkanes Functions</h3>
    <ul>
      <li><a href="simulate.html">simulate</a></li>
      <li><a href="trace-method.html">trace</a></li>
      <li><a href="traceblock.html">traceblock</a></li>
      <li><a href="multisimulate.html">multisimulate</a></li>
    </ul>
    
    <!-- Protorune Functions -->
    <h3>Protorune Functions</h3>
    <ul>
      <li><a href="protorunesbyaddress.html">protorunesbyaddress</a></li>
      <li><a href="protorunesbyoutpoint.html">protorunesbyoutpoint</a></li>
      <li><a href="protorunesbyheight.html">protorunesbyheight</a></li>
      <li><a href="spendablesbyaddress.html">spendablesbyaddress</a></li>
    </ul>
    
    <!-- Runes Compatibility -->
    <h3>Runes Compatibility</h3>
    <ul>
      <li><a href="runesbyaddress.html">runesbyaddress</a></li>
      <li><a href="runesbyoutpoint.html">runesbyoutpoint</a></li>
      <li><a href="runesbyheight.html">runesbyheight</a></li>
    </ul>
    
    <!-- JSON-RPC Methods -->
    <h3>JSON-RPC Methods</h3>
    <ul>
      <li><a href="metashrew-height.html">metashrew_height</a></li>
      <li><a href="sandshrew-multicall.html">sandshrew_multicall</a></li>
      <li><a href="btc-getblockcount.html">btc_getblockcount</a></li>
    </ul>
    
    <!-- Indexer Functions -->
    <h3>Indexer Functions</h3>
    <ul>
      <li><a href="alkane-inventory.html">alkane_inventory</a></li>
      <li><a href="call-view.html">call_view</a></li>
      <li><a href="call-multiview.html">call_multiview</a></li>
    </ul>
    
    <div class="sidebar-footer">
      <a href="../index.html">‚Üê Back to Homepage</a>
    </div>
  </div>

  <!-- Main Content -->
  <div class="main-content">
    <!-- Method Header -->
    <div class="method-header">
      <div class="method-title">
        <h1>trace</h1>
        <span class="method-badge badge-alkanes">View Function</span>
      </div>
      <p class="method-description">Gets a detailed execution trace of a transaction, showing each step of contract execution including opcodes, stack values, and execution context. Essential for debugging contract behavior.</p>
    </div>
    
    <!-- Method Metadata -->
    <div class="method-metadata">
      <div class="metadata-item">
        <div class="metadata-label">Method Type:</div>
        <div class="metadata-value">Alkanes View Function</div>
      </div>
      <div class="metadata-item">
        <div class="metadata-label">JSON-RPC Method:</div>
        <div class="metadata-value">metashrew_view</div>
      </div>
      <div class="metadata-item">
        <div class="metadata-label">View Function:</div>
        <div class="metadata-value">trace</div>
      </div>
      <div class="metadata-item">
        <div class="metadata-label">Required Parameters:</div>
        <div class="metadata-value">txid, blockHeight</div>
      </div>
    </div>
    
    <!-- Examples Section -->
    <div class="example-container">
      <h2>Examples</h2>
      
      <div class="example-tabs">
        <div class="example-tab active" data-target="request-example">Request</div>
        <div class="example-tab" data-target="response-example">Response</div>
        <div class="example-tab" data-target="curl-example">cURL</div>
      </div>
      
      <div id="request-example" class="example-content">
        <h3>Example Request</h3>
        <div class="code-block">{
  "method": "metashrew_view",
  "params": [
    "trace",
    "3a7e834b2a4a94cd9fc3d6b4e6dc6eba39c3d05cb16d12ce4f1670dcdfd22c01",
    "0x00D76FE0"
  ],
  "id": 0,
  "jsonrpc": "2.0"
}</div>
      </div>
      
      <div id="response-example" class="example-content" style="display: none;">
        <h3>Example Response</h3>
        <div class="code-block">{
  "jsonrpc": "2.0",
  "result": {
    "trace": [
      {
        "pc": 0,
        "op": "OP_0",
        "stack": [""]
      },
      {
        "pc": 1,
        "op": "OP_IF",
        "stack": []
      },
      // Additional trace steps omitted for brevity
    ],
    "success": true,
    "output": "0x6a14fada28d8b3798c11a0b47c2e9b77b8c96dea2d8c",
    "gas_used": 3215
  },
  "id": 0
}</div>
      </div>
      
      <div id="curl-example" class="example-content" style="display: none;">
        <h3>cURL Command</h3>
        <div class="code-block">curl -X POST "https://mainnet.sandshrew.io/v2/lasereyes" \
  -H "Content-Type: application/json" \
  -d '{
  "method": "metashrew_view",
  "params": ["trace","3a7e834b2a4a94cd9fc3d6b4e6dc6eba39c3d05cb16d12ce4f1670dcdfd22c01","0x00D76FE0"],
  "id": 0,
  "jsonrpc": "2.0"
}'</div>
      </div>
    </div>
    
    <!-- Usage Section -->
    <div class="usage-section">
      <h2>Try It</h2>
      
      <div class="endpoint-status-display">
        <div class="status-indicator"></div>
        <div class="status-text">Checking endpoint...</div>
      </div>
      
      <form class="usage-form api-test-form">
        <div class="form-group">
          <label for="method-name">Method:</label>
          <input type="text" id="method-name" value="metashrew_view" readonly>
        </div>
        
        <div class="form-group">
          <label for="txid-input">Transaction ID:</label>
          <input type="text" id="txid-input" placeholder="Enter a transaction ID" value="3a7e834b2a4a94cd9fc3d6b4e6dc6eba39c3d05cb16d12ce4f1670dcdfd22c01">
        </div>
        
        <div class="form-group">
          <label for="block-height-input">Block Height (hex):</label>
          <input type="text" id="block-height-input" placeholder="e.g., 0x00D76FE0 or 'latest'" value="0x00D76FE0">
        </div>
        
        <div class="form-group">
          <label for="method-params">Parameters (JSON array - auto-generated):</label>
          <textarea id="method-params" readonly>[
  "trace",
  "3a7e834b2a4a94cd9fc3d6b4e6dc6eba39c3d05cb16d12ce4f1670dcdfd22c01",
  "0x00D76FE0"
]</textarea>
        </div>
        
        <button type="submit">Execute Request</button>
      </form>
      
      <div class="results-container">
        <p>Results will appear here after execution.</p>
      </div>
    </div>
    
    <!-- Notes Section -->
    <div class="notes-section">
      <h2>Notes</h2>
      <ul>
        <li><strong>Transaction ID:</strong> Provide the hexadecimal transaction ID of the transaction you want to trace.</li>
        <li><strong>Block Height:</strong> Can be provided as a hexadecimal string (e.g., "0x00D76FE0") or use "latest" for the most recent block.</li>
        <li><strong>Trace Output:</strong> The trace output shows the step-by-step execution of the Bitcoin script, including opcodes executed and stack values at each step.</li>
        <li><strong>Success Flag:</strong> The "success" field indicates whether the script executed successfully.</li>
        <li><strong>Gas Used:</strong> Indicates the computational resources consumed by the transaction execution.</li>
        <li><strong>Output:</strong> The final output of the script execution, typically a hexadecimal value.</li>
      </ul>
    </div>
  </div>

  <!-- Create an endpoint toggle container -->
  <div id="endpoint-toggle-container"></div>

  <!-- Scripts -->
  <script src="../js/api-client.js"></script>
  <script src="../js/endpoint-toggle.js"></script>
  <script src="../js/api-methods.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // Initialize endpoint toggle
      window.endpointToggle = new EndpointToggleComponent({
        onEndpointChange: (newEndpoint) => {
          console.log(`Endpoint changed to: ${newEndpoint}`);
          // Refresh the endpoint status display
          updateEndpointStatus();
        }
      });
      
      // Setup endpoint status display
      function updateEndpointStatus() {
        const statusIndicator = document.querySelector('.status-indicator');
        const statusText = document.querySelector('.status-text');
        
        if (!statusIndicator || !statusText) return;
        
        statusText.textContent = 'Checking endpoint...';
        statusIndicator.className = 'status-indicator pending';
        
        // Create a fresh API client to get current endpoint status
        const apiClient = new MetashrewApiClient();
        apiClient.checkSync()
          .then(result => {
            const { height, nodeHeight, syncPercentage } = result;
            statusText.textContent = `Connected: Height ${height}/${nodeHeight} (${syncPercentage}% in sync)`;
            statusIndicator.className = 'status-indicator success';
          })
          .catch(error => {
            console.error('Error checking endpoint:', error);
            statusText.textContent = 'Error connecting to endpoint';
            statusIndicator.className = 'status-indicator error';
          });
      }
      
      // Update params when inputs change
      function updateParams() {
        const txidInput = document.getElementById('txid-input');
        const blockHeightInput = document.getElementById('block-height-input');
        const methodParams = document.getElementById('method-params');
        
        if (txidInput && blockHeightInput && methodParams) {
          const params = [
            "trace",
            txidInput.value.trim(),
            blockHeightInput.value.trim()
          ];
          methodParams.value = JSON.stringify(params, null, 2);
        }
      }
      
      // Update endpoint status on page load
      updateEndpointStatus();
      
      // Listen for endpoint changes
      document.addEventListener('endpoint-changed', () => {
        updateEndpointStatus();
      });
      
      // Add event listeners for input changes
      const txidInput = document.getElementById('txid-input');
      const blockHeightInput = document.getElementById('block-height-input');
      
      txidInput.addEventListener('input', updateParams);
      blockHeightInput.addEventListener('input', updateParams);
    });
  </script>
</body>
</html>
